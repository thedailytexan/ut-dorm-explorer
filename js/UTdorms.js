L.mapbox.accessToken = 'pk.eyJ1Ijoic2NpZiIsImEiOiJjaWgyOHJkZW8weHJrd3dtMHJ1cnV0ZDY2In0.5wK8t52sB90Exoi6StYlBw';
var geoData = [
    {
        "type": "FeatureCollection",
        "features": [
            {
                "type": "Feature",
                "properties": {
                    "marker-color": "#cc5527",
                    "marker-size": "medium",
                    "marker-symbol": "building",
                    "name": "Andrews",
                    "address": "2401 Whitis Avenue",
                    "link": "andrews"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -97.73982524871825,
                        30.288177779561856
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "marker-color": "#cc5527",
                    "marker-size": "medium",
                    "marker-symbol": "building",
                    "link": "blanton",
                    "name": "Blanton",
                    "address": "2500 University Avenue"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -97.73937463760376,
                        30.288661840447016
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "marker-color": "#cc5527",
                    "marker-size": "medium",
                    "marker-symbol": "building",
                    "name": "Brackenridge",
                    "link": "brackenridge",
                    "address": "303 East 21st Street"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -97.73593068122864,
                        30.283135529663728
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "marker-color": "#cc5527",
                    "marker-size": "medium",
                    "marker-symbol": "building",
                    "link": "carothers",
                    "name": "Carothers",
                    "address": "2501 Whitis Avenue"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -97.74010956287384,
                        30.288689633344013
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "marker-color": "#cc5527",
                    "marker-size": "medium",
                    "marker-symbol": "building",
                    "link": "creekside",
                    "name": "Creekside",
                    "address": "2500 San Jacinto Blvd"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -97.73337721824645,
                        30.288527508000662
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "marker-color": "#cc5527",
                    "marker-size": "medium",
                    "marker-symbol": "building",
                    "link": "duren",
                    "name": "Duren",
                    "address": "2604 Whitis Avenue"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -97.74039924144745,
                        30.291390138943623
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "marker-color": "#cc5527",
                    "marker-size": "medium",
                    "marker-symbol": "building",
                    "name": "Jester East",
                    "link": "jester%20east",
                    "address": "201 East 21st Street"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -97.73595750331877,
                        30.2823758113038
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "marker-color": "#cc5527",
                    "marker-size": "medium",
                    "marker-symbol": "building",
                    "name": "Jester West",
                    "link": "jester%20west",
                    "address": "201 East 21st Street"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -97.73670315742491,
                        30.282125658849186
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "marker-color": "#cc5527",
                    "marker-size": "medium",
                    "marker-symbol": "building",
                    "link": "kinsolving",
                    "name": "Kinsolving",
                    "address": "2605 Whitis Avenue"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -97.73965895175934,
                        30.290320136184143
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "marker-color": "#cc5527",
                    "marker-size": "medium",
                    "marker-symbol": "building",
                    "link": "littlefield",
                    "name": "Littlefield",
                    "address": "2503 Whitis Avenue"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -97.73972332477568,
                        30.289319603563253
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "marker-color": "#cc5527",
                    "marker-size": "medium",
                    "marker-symbol": "building",
                    "name": "Moore-Hill",
                    "link": "moore-hill",
                    "address": "304 East 21st Street"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -97.73538887500763,
                        30.283603402068238
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "marker-color": "#cc5527",
                    "marker-size": "medium",
                    "marker-symbol": "building",
                    "name": "Prather",
                    "link": "prather",
                    "address": "305 East 21st Street"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -97.73509919643402,
                        30.282389708643695
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "marker-color": "#cc5527",
                    "marker-size": "medium",
                    "marker-symbol": "building",
                    "name": "Roberts",
                    "link": "roberts",
                    "address": "303 East 21st Street"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -97.73516893386841,
                        30.2830660434728
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "marker-color": "#cc5527",
                    "marker-size": "medium",
                    "marker-symbol": "building",
                    "name": "San Jacinto",
                    "link": "san%20jacinto",
                    "address": "309 East 21st Street"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -97.73434281349182,
                        30.282496254850795
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "marker-color": "#cc5527",
                    "marker-size": "medium",
                    "marker-symbol": "building",
                    "link": "whitis%20court",
                    "name": "Whitis Court",
                    "address": "2610 Whitis Avenue"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -97.74073183536528,
                        30.290852822999625
                    ]
                }
            }
        ]
    }
];
var geoJSON_attractions = [
    {
        "type": "FeatureCollection",
        "features": [
            {
                "type": "Feature",
                "properties": {
                    "marker-color": "#d0d0d0",
                    "marker-size": "small",
                    "marker-symbol": "america-football",
                    "name": "Darrell K Royal - Texas Memorial Stadium"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -97.7325189113617,
                        30.283686785034806
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "marker-color": "#d0d0d0",
                    "marker-size": "small",
                    "marker-symbol": "basketball",
                    "name": "Gregory Gym"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -97.7363920211792,
                        30.28396472774488
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "marker-color": "#d0d0d0",
                    "marker-size": "small",
                    "marker-symbol": "library",
                    "name": "Perry-Caste√±eda Library"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -97.7382481098175,
                        30.282788098216884
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "marker-color": "#d0d0d0",
                    "marker-size": "small",
                    "marker-symbol": "town-hall",
                    "name": "Main Building (UT Tower)"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -97.73939609527588,
                        30.28604927297253
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "marker-color": "#d0d0d0",
                    "marker-size": "small",
                    "marker-symbol": "art-gallery",
                    "name": "Blanton Museum of Art"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -97.73743271827698,
                        30.281027759978798
                    ]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "marker-color": "#d0d0d0",
                    "marker-size": "small",
                    "marker-symbol": "art-gallery",
                    "name": "Harry Ransom Center"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -97.74125218391418,
                        30.28433531680018
                    ]
                }
            }
        ]
    }
];
var southWest = L.latLng(30.293, -97.732),
    northEast = L.latLng(30.281, -97.743),
    bounds = L.latLngBounds(southWest, northEast);

var map = L.mapbox.map('homepage-map', 'mapbox.streets', {
    maxBounds: bounds,
    minZoom: 14
}).setView([30.287, -97.738], 16);
map.fitBounds(bounds)

var listings = document.getElementById('listings');
var locations = L.mapbox.featureLayer().addTo(map);
locations.setGeoJSON(geoData);

var attractions = L.mapbox.featureLayer().addTo(map);
attractions.setGeoJSON(geoJSON_attractions);


function setActive(el) {
    var siblings = listings.getElementsByTagName('div');
    for (var i = 0; i < siblings.length; i++) {
        siblings[i].className = siblings[i].className
            .replace(/active/, '').replace(/\s\s*$/, '');
    }
    el.className += ' active';
}

locations.eachLayer(function (locale) {
    var prop = locale.feature.properties;
    var popup = '<a href="' + prop.link + '" target="_blank">' + '<h2>' + prop.name + '</h2></a><p>' + prop.address + "</p>";
    var listing = listings.appendChild(document.createElement('div'));
    listing.className = 'list-item';
    var link = listing.appendChild(document.createElement('a'));
    link.href = '/' + prop.link;
    link.className = 'title';
    link.innerHTML = prop.name;
    var direct_link = listing.appendChild(document.createElement('a'));
    direct_link.href = '#';
    direct_link.className = 'direct-link';
    direct_link.innerHTML = "<i class='fa fa-location-arrow'></i>";
    direct_link.onclick = function () {
        setActive(listing);
        map.setView(locale.getLatLng(), 18);
        locale.openPopup();
        return false;
    };
    locale.on('click', function (e) {
        map.setView(locale.getLatLng(), 18);
        setActive(listing);
    });
    locale.bindPopup(popup);
});

attractions.eachLayer(function(layer){
    var prop = layer.feature.properties;
    var attraction_popup = '<span>' + prop.name + '</span>';
    layer.bindPopup(attraction_popup);
});

